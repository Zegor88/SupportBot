# src/rules.yaml
# This file contains the rules for the bot.

rules:
  # --- Behavioral Rules (these add context and allow processing to continue) ---
  - rule_id: "BEHAVIOR_GREETING"
    priority: 1
    continue_on_match: true # This makes the rule non-terminal
    conditions:
      - type: "description_match"
        description: "The user's message contains a greeting (e.g., 'hi', 'hello', 'good morning')."
    action: "reply"
    action_params:
      behavioral_prompts:
        - "The user started with a greeting. Greet them back warmly before addressing their main query."

  # --- Terminal Rules (these stop processing and define the final action) ---
  - rule_id: "FAREWELL"
    priority: 10
    conditions:
      - type: "description_match"
        description: "The user says goodbye to the bot, says thanks and ends the conversation, etc."
    action: "reply"
    action_params:
      response_text: "You are welcome! Have a great day."

  - rule_id: "HAMSTER_COMBAT_SUPPORT_REDIRECT"
    priority: 20
    conditions: 
      - type: "keyword_match"
        keywords: ["hamster combat", "hmstr", "hamster kombat"]
        match_type: "any"
        case_sensitive: false
    action: "reply"
    action_params:
      response_text: "This chat doesn't provide support for Hamster Boost. Please contact @Hamster_Boost_Support_bot for assistance with your query."

  - rule_id: "hamster_withdraw"
    priority: 21
    conditions:
      - type: "keyword_match"
        keywords: ["hamster combat", "hmstr", "hamster kombat"]
        match_type: "any"
        case_sensitive: false
      - type: "description_match"
        description: "The user is asking how to withdraw funds, get a reward, or use a boost."
    action: "reply"
    action_params:
      response_text: "Hello! If you have received a reward in Hamster Boost, follow these instructions: https://t.me/broxus_chat/26814"
      
  # --- Test Rules ---
  - rule_id: "test_drop_action"
    priority: 200
    conditions:
      - type: "keyword_match"
        keywords: ["test drop please"]
        match_type: "all"
    action: "drop"
    action_params: {}

  - rule_id: "test_forward_action"
    priority: 201
    conditions:
      - type: "keyword_match"
        keywords: ["test forward please"]
        match_type: "all"
    action: "forward"
    action_params:
      destination_chat_id: "-1002548823433" 

  - rule_id: "test_direct_reply_action"
    priority: 202
    conditions:
      - type: "keyword_match"
        keywords: ["test direct reply please"]
        match_type: "all"
    action: "reply"
    action_params:
      response_text: "This is a direct reply test. It worked!"

  - rule_id: "test_handoff_reply_action"
    priority: 203
    conditions:
      - type: "keyword_match"
        keywords: ["test handoff reply please"]
        match_type: "all"
    action: "reply"
    action_params:
      system_prompt_key: "test_handoff_prompt" 